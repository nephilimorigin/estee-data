<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AylÄ±k Hedef AyarÄ±</title>

<style>
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Inter,Arial;
  background:linear-gradient(135deg,#c3cfe2,#fde2e4,#edf2fb);
  background-size:300% 300%;
  animation:gradientAni 12s ease infinite;
}
@keyframes gradientAni{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
.top-nav{
  display:flex;
  justify-content:space-around;
  padding:12px;
  background:rgba(255,255,255,0.35);
  backdrop-filter:blur(10px);
}
.top-nav a{
  text-decoration:none;
  font-weight:600;
  color:#4b3f72;
}
.container{
  max-width:480px;
  margin:40px auto;
  padding:22px;
  border-radius:20px;
  background:rgba(255,255,255,0.55);
  backdrop-filter:blur(16px);
  box-shadow:0 8px 25px rgba(0,0,0,0.1);
}
h1{text-align:center;color:#374785;}
label{margin-top:14px;display:block;font-weight:600;}
input{
  width:100%;
  padding:14px;
  margin-top:6px;
  border-radius:14px;
  border:none;
}
button{
  width:100%;
  margin-top:25px;
  padding:14px;
  border:none;
  border-radius:18px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="top-nav">
  <a href="setup.html">ğŸ¯ AyÄ± BaÅŸlat</a>
  <a href="form.html">ğŸ“ GÃ¼nlÃ¼k Veri</a>
  <a href="dashboard.html">ğŸ“Š Dashboard</a>
</div>

<div class="container">
<h1>AylÄ±k Hedef AyarÄ±</h1>

<label>Hangi Ay Ä°Ã§in?</label>
<input type="month" id="monthKey">

<label>AylÄ±k Ciro Hedefi (TL)</label>
<input type="text" id="monthlyGoal">

<label>Fokus 1 AdÄ±</label>
<input type="text" id="fokus1_ad">
<label>Fokus 1 Hedef</label>
<input type="number" id="fokus1_hedef">

<label>Fokus 2 AdÄ±</label>
<input type="text" id="fokus2_ad">
<label>Fokus 2 Hedef</label>
<input type="number" id="fokus2_hedef">

<label>Fokus 3 AdÄ±</label>
<input type="text" id="fokus3_ad">
<label>Fokus 3 Hedef</label>
<input type="number" id="fokus3_hedef">

<button id="saveBtn">Kaydet</button>
</div>

<script type="module">
import {
  formatTLLive,
  TLtoNumber,
  saveMonthlyStats,
  loadMonthlyStats
} from "./common.js";

const monthInput=document.getElementById("monthKey");
const goalInput=document.getElementById("monthlyGoal");

// default = bu ay
const now=new Date();
monthInput.value=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`;

goalInput.addEventListener("input",()=>{
  const p=goalInput.selectionStart;
  const b=goalInput.value.length;
  goalInput.value=formatTLLive(goalInput.value);
  const a=goalInput.value.length;
  goalInput.selectionEnd=p+(a-b);
});

async function loadMonth(){
  const all=await loadMonthlyStats();
  const m=monthInput.value;
  const d=all[m];

  const fields=["fokus1_ad","fokus1_hedef","fokus2_ad","fokus2_hedef","fokus3_ad","fokus3_hedef"];
  fields.forEach(id=>document.getElementById(id).value="");
  goalInput.value="";

  if(!d) return;

  goalInput.value=formatTLLive(d.monthlyGoal||0);
  fields.forEach(id=>document.getElementById(id).value=d[id]||"");
}

monthInput.addEventListener("change",loadMonth);
loadMonth();

document.getElementById("saveBtn").onclick=async()=>{
  const m=monthInput.value;
  if(!m) return alert("Ay seÃ§melisin");

  const data={
    monthlyGoal:TLtoNumber(goalInput.value),
    fokus1_ad:fokus1_ad.value,
    fokus1_hedef:Number(fokus1_hedef.value),
    fokus2_ad:fokus2_ad.value,
    fokus2_hedef:Number(fokus2_hedef.value),
    fokus3_ad:fokus3_ad.value,
    fokus3_hedef:Number(fokus3_hedef.value)
  };

  await saveMonthlyStats(m,data);
  alert("âœ” Ay baÅŸarÄ±yla baÅŸlatÄ±ldÄ±");
};
</script>

</body>
</html>